kind: pipeline
type: docker
name: default

platform:
  os: linux
  arch: amd64

steps:
  - name: build
    image: docker:dind
    privileged: true
    volumes:
      - name: dockersock
        path: /var/run
    commands:
      - export GOTIFY_VERSION=$(echo $GOTIFY_RELEASE_TITLE | awk '{print $2}')
      - echo "Building gotify version $GOTIFY_VERSION"
      - sleep 5 # give docker enough time to start
      - docker ps -a
      - apk --no-cache add build-base
      - make build-linux-amd64
      - make build-linux-arm64
      - make build-linux-arm-7

services:
  - name: docker
    image: docker:dind
    privileged: true
    volumes:
      - name: dockersock
        path: /var/run
